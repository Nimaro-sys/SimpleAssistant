<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üîç Recherche DC - Outils Staff</title>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>

  <style>
    /* === STYLE GLOBAL === */
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: radial-gradient(circle at top, #1a1a1d, #0e0e11);
      color: #f5f5f5;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* === HEADER === */
    header {
      width: 100%;
      background: rgba(20, 20, 25, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    header h1 {
      font-size: 1.5rem;
      background: linear-gradient(90deg, #00c6ff, #0072ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .back-home {
      text-decoration: none;
      color: #aaa;
      transition: 0.3s;
    }
    .back-home:hover {
      color: #fff;
    }

    /* === MAIN CONTAINER === */
    main {
      width: 100%;
      max-width: 1000px;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    label {
      align-self: flex-start;
      font-weight: 500;
      color: #ccc;
      margin-top: 1rem;
    }

    textarea, input[type="text"] {
      width: 100%;
      border: none;
      outline: none;
      border-radius: 10px;
      background: #1e1e22;
      color: #eee;
      padding: 0.9rem 1rem;
      font-size: 1rem;
      resize: vertical;
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
    }

    textarea:focus, input[type="text"]:focus {
      background: #26262d;
      box-shadow: 0 0 10px #0072ff88;
    }

    input[type="text"] {
      background: #202025;
    }

    /* === TABLE === */
    table {
      width: 100%;
      border-collapse: collapse;
      background: #18181b;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      margin-top: 1rem;
    }

    thead {
      background: linear-gradient(90deg, #0072ff, #00c6ff);
      color: white;
    }

    th, td {
      padding: 0.9rem 1rem;
      text-align: left;
    }

    tbody tr {
      border-bottom: 1px solid rgba(255,255,255,0.05);
      transition: background 0.2s;
    }

    tbody tr:hover {
      background: #24242b;
    }

    .favorite {
      background: linear-gradient(90deg, rgba(255,215,0,0.1), rgba(255,215,0,0.02));
    }

    /* === BOUTONS === */
    button {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1.2rem;
      transition: transform 0.2s, color 0.3s;
    }

    .fav-btn {
      color: #888;
    }
    .fav-btn:hover {
      transform: scale(1.2);
      color: #ffd700;
    }
    .fav-btn.active {
      color: #ffd700;
      text-shadow: 0 0 8px #ffd70088;
    }

    .copy-btn {
      color: #00c6ff;
    }
    .copy-btn:hover {
      transform: scale(1.2);
      color: #00e0ff;
    }

    /* === RESPONSIVE === */
    @media (max-width: 800px) {
      main {
        padding: 1rem;
      }
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead {
        display: none;
      }
      tbody tr {
        margin-bottom: 1rem;
        border-radius: 10px;
        padding: 1rem;
        background: #1b1b20;
      }
      td {
        display: flex;
        justify-content: space-between;
        padding: 0.4rem 0;
      }
      td::before {
        content: attr(data-label);
        font-weight: 600;
        color: #888;
      }
    }

    /* === ANIM === */
    tr {
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(3px);}
      to {opacity: 1; transform: translateY(0);}
    }
  </style>
</head>

<body>
  <header>
    <a href="index.html" class="back-home">‚Üê Retour</a>
    <h1>Recherche DC</h1>
  </header>

  <main>
    <label for="rawInput">Colle ici la liste des joueurs :</label>
    <textarea id="rawInput" rows="8" placeholder="Ex: Jean Dupont\t\t Temps jou√©: \t3 jours, 4 heures et 5 minutes (76.0833 heures au total)"></textarea>

    <input type="text" id="searchInput" placeholder="üîé Rechercher un joueur..." />

    <table>
      <thead>
        <tr>
          <th>Nom</th>
          <th>Temps total (h)</th>
          <th>D√©tail</th>
          <th>‚≠ê</th>
          <th>üìã</th>
        </tr>
      </thead>
      <tbody id="playersTable"></tbody>
    </table>
  </main>

  <script>
    const tableBody = document.getElementById("playersTable");
    const searchInput = document.getElementById("searchInput");
    const rawInput = document.getElementById("rawInput");

    const parseData = (input) => {
      const lines = input.split("\n").filter(line => line.includes("heures au total"));
      const data = lines.map(line => {
        const name = line.split("\t")[0].trim();
        const heuresMatch = line.match(/\((\d+\.?\d*) heures au total\)/);
        const detailMatch = line.match(/Temps jou√©: +(.*) \(/);
        return {
          name,
          detail: detailMatch ? detailMatch[1] : "",
          total: heuresMatch ? parseFloat(heuresMatch[1]) : 0,
          favorite: false
        };
      });
      return _.orderBy(data, ['total'], ['desc']);
    };

    let currentData = [];

    const renderTable = (data) => {
      tableBody.innerHTML = "";
      data.forEach(player => {
        const row = document.createElement("tr");
        if (player.favorite) row.classList.add("favorite");

        const favBtn = document.createElement("button");
        favBtn.classList.add("fav-btn");
        if (player.favorite) favBtn.classList.add("active");
        favBtn.innerHTML = player.favorite ? '‚òÖ' : '‚òÜ';
        favBtn.onclick = () => {
          player.favorite = !player.favorite;
          renderTable(currentData);
        };

        const copyBtn = document.createElement("button");
        copyBtn.textContent = "üìã";
        copyBtn.title = "Copier /flag [Nom]";
        copyBtn.classList.add("copy-btn");
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(`/flag ${player.name}`);
          copyBtn.textContent = "‚úÖ";
          setTimeout(() => copyBtn.textContent = "üìã", 1000);
        };

        row.innerHTML = `
          <td data-label="Nom">${player.name}</td>
          <td data-label="Temps total (h)">${player.total.toFixed(2)}</td>
          <td data-label="D√©tail">${player.detail}</td>
        `;
        const favCell = document.createElement("td");
        favCell.appendChild(favBtn);
        row.appendChild(favCell);

        const copyCell = document.createElement("td");
        copyCell.appendChild(copyBtn);
        row.appendChild(copyCell);

        tableBody.appendChild(row);
      });
    };

    rawInput.addEventListener("input", () => {
      currentData = parseData(rawInput.value);
      renderTable(currentData);
    });

    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase();
      const filtered = currentData.filter(player => player.name.toLowerCase().includes(query));
      renderTable(filtered);
    });
  </script>
</body>
</html>
